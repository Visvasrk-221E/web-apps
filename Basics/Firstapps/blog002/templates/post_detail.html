{% extends "base.html" %}
{% block title %}{{ post.title }} - Noir Blog{% endblock %}
{% block content %}
<div class="card glass p-4 mt-4">
  <h2>{{ post.title }}</h2>
  <div class="small text-muted mb-3">
    By <a href="{{ url_for('profile', username=post.author.username) }}">{{ post.author.username }}</a> · {{ post.created_at.strftime('%Y-%m-%d %H:%M') }} · {{ post.topic.name }}
  </div>

  <div class="markdown-body mb-3">
    {{ html_body | safe }}
  </div>

  {% if post.attachment_filename %}
    <a class="btn btn-sm btn-outline-light" href="{{ url_for('post_download', post_id=post.id) }}">Download Attachment</a>
  {% endif %}

  <hr class="border-secondary">

  <h5>Comments</h5>
  {% if current_user.is_authenticated %}
    <form method="post" action="{{ url_for('post_comment', post_id=post.id) }}">
      <textarea name="comment" class="form-control bg-black text-light mb-2" rows="3" placeholder="Write a comment..."></textarea>
      <button class="btn btn-outline-light mt-1">Comment</button>
    </form>
  {% else %}
    <p class="text-muted">You must <a class="btn btn-sm btn-outline-light" href="{{ url_for('login', next=request.path) }}">login</a> to comment.</p>
  {% endif %}

  <div class="mt-3">
    {% for c in comments %}
      <div class="border-top pt-2">
        <div class="small text-muted">{{ c.author.username }} · {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
        <div class="mt-1">{{ c.body }}</div>
      </div>
    {% else %}
      <div class="text-muted small mt-2">No comments yet.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
